(this.webpackJsonpforum=this.webpackJsonpforum||[]).push([[0],{105:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(51),u=a.n(c),l=(a(59),a(60),a(17)),s=a(1),o=a(4),i=a.n(o),m=a(9),d=a(2),p=a(18),f={loggedIn:!1,user:{email:null,handle:null,imageUrl:null}},b=Object(n.createContext)(f),v=b.Provider,h=function(e){var t=e.children,a=Object(n.useReducer)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOG_IN":return Object(p.a)(Object(p.a)({},e),{},{loggedIn:!0});case"FETCH_USER":return Object(p.a)(Object(p.a)({},e),{},{user:t.payload});default:return e}}),f),c=Object(d.a)(a,2),u=c[0],l=c[1];return r.a.createElement(v,{value:{state:u,dispatch:l}},t)},E=a(29),g=a.n(E),O=g.a.query,j=new g.a.Client({secret:"fnAD1yQ6nyACATcGUq8PXJ39ZoIVPdQIngRkw6j6"}),w=a(52),y=new(a.n(w).a)({APIUrl:"https://forum-wtchs.netlify.app/.netlify/identity",audience:"",setCookie:!1});var x=function(e,t){return function(a){var c=Object(n.useState)(!0),u=Object(d.a)(c,2),l=u[0],s=u[1];return r.a.createElement(r.a.Fragment,null,l&&r.a.createElement("h1",null,t),r.a.createElement(e,Object.assign({},a,{setIsLoading:s})))}};var I=x((function(e){var t=e.setIsLoading,a=Object(n.useContext)(b),c=(a.state,a.dispatch),u=Object(n.useState)(),l=Object(d.a)(u,2),s=l[0],o=l[1],p=Object(n.useState)(),f=Object(d.a)(p,2),v=f[0],h=f[1],E=Object(n.useState)(),g=Object(d.a)(E,2),w=g[0],x=g[1],I=Object(n.useState)(),C=Object(d.a)(I,2),S=C[0],k=C[1],q=Object(n.useState)(),_=Object(d.a)(q,2),U=_[0],L=_[1],P=Object(n.useState)(),F=Object(d.a)(P,2),G=F[0],N=F[1],M=Object(n.useState)(),T=Object(d.a)(M,2),A=T[0],J=T[1],R=Object(n.useState)(),D=Object(d.a)(R,2),H=D[0],X=D[1];Object(n.useEffect)((function(){null!==y.currentUser()&&void 0!==y.currentUser()&&c({type:"LOG_IN"}),t(!1)}),[]);var B=function(){var e=Object(m.a)(i.a.mark((function e(a){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(!0),e.prev=1,a.preventDefault(),e.next=5,new Promise(function(){var e=Object(m.a)(i.a.mark((function e(t,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.query(O.Exists(O.Match(O.Index("users_by_handle"),O.Casefold(v))));case 3:!0===e.sent?(L(!1),t(!1)):(L(!0),t(!0)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),a(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,a){return e.apply(this,arguments)}}());case 5:return n=e.sent,e.next=8,new Promise(function(){var e=Object(m.a)(i.a.mark((function e(t,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.query(O.Exists(O.Match(O.Index("users_by_email"),O.Casefold(s))));case 3:!0===e.sent?(N(!1),t(!1)):(N(!0),t(!0)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),a(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,a){return e.apply(this,arguments)}}());case 8:if(r=e.sent,!(n&&r&&(w===S?(J(!0),1):(J(!1),0)))){e.next=17;break}return e.next=12,y.signup(s,w);case 12:return e.next=14,new Promise(function(){var e=Object(m.a)(i.a.mark((function e(t,a){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.query(O.Create(O.Collection("users"),{data:{handle:v,email:s,imageUrl:"imageUrl1.com"}}));case 3:n=e.sent,t(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),a(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,a){return e.apply(this,arguments)}}());case 14:return e.next=16,y.login(s,w,!0);case 16:c({type:"LOG_IN"});case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(1),console.log(e.t0),X(!0);case 23:t(!1);case 24:case"end":return e.stop()}}),e,null,[[1,19]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("form",{onSubmit:function(e){B(e)},method:"post"},r.a.createElement("label",{htmlFor:"email"},"Email:"),r.a.createElement("input",{type:"email",name:"email",id:"email",onChange:function(e){N(void 0),X(!1),o(e.target.value)},required:"required"}),!1===G?r.a.createElement("p",null,"This email is already in use"):null,r.a.createElement("label",{htmlFor:"handle"},"Username:"),r.a.createElement("input",{type:"text",name:"handle",id:"handle",onChange:function(e){L(void 0),X(!1),h(e.target.value)},required:"required"}),!1===U?r.a.createElement("p",null,"This handle is already in use"):null,r.a.createElement("label",{htmlFor:"password"},"Password:"),r.a.createElement("input",{type:"password",name:"password",id:"password",onChange:function(e){x(e.target.value),X(!1),J(!0)},required:"required"}),r.a.createElement("label",{htmlFor:"confirmPassword"},"Confirm password:"),r.a.createElement("input",{type:"password",name:"confirmPassword",id:"confirmPassword",onChange:function(e){k(e.target.value),X(!1),J(!0)},required:"required"}),!1===A?r.a.createElement("p",null,"Passwords don't match"):null,H&&r.a.createElement("p",null,"Error occured, please try again later"),r.a.createElement("button",{type:"submit"},"Signup"))}),"loading");var C=x((function(e){var t=e.setIsLoading,a=Object(n.useContext)(b),c=a.state,u=a.dispatch,s=Object(n.useState)(),o=Object(d.a)(s,2),p=o[0],f=o[1],v=function(){var e=Object(m.a)(i.a.mark((function e(){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/.netlify/functions/avatar");case 2:return a=e.sent,e.next=5,JSON.parse(a);case 5:return e.sent,console.log(a),t(!0),e.next=10,j.query(O.Get(O.Match(O.Index("users_by_email"),O.Casefold(p))));case 10:n=e.sent,u({type:"FETCH_USER",payload:n.data}),t(!1);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){null!==y.currentUser()&&void 0!==y.currentUser()&&(u({type:"LOG_IN"}),f(y.currentUser().email))}),[]),Object(n.useEffect)((function(){null!==p&&void 0!==p&&v()}),[p]),r.a.createElement(r.a.Fragment,null,c.loggedIn?r.a.createElement("div",null,r.a.createElement("p",null,c.user.handle),r.a.createElement("p",null,c.user.email),r.a.createElement("img",{src:c.user.imageUrl,alt:"profile image"})):r.a.createElement("div",null,r.a.createElement(l.b,{to:"/login"},"Login"),r.a.createElement(l.b,{to:"/signup"},"Signup")))}),"wait...");var S=x((function(e){var t=e.setIsLoading,a=Object(n.useState)([]),c=Object(d.a)(a,2),u=c[0],l=c[1],s=function(){var e=Object(m.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.query(O.Map(O.Paginate(O.Match(O.Index("all_posts"))),O.Lambda("X",O.Get(O.Var("X")))));case 2:a=e.sent,l(a.data),t(!1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){s()}),[]),r.a.createElement("div",null,u.map((function(e,t){return r.a.createElement("div",{key:t},r.a.createElement("p",null,e.data.body),r.a.createElement("h6",null,e.data.userHandle))})),r.a.createElement(C,null))}),"wait...");var k=x((function(e){var t=e.setIsLoading,a=Object(n.useContext)(b),c=(a.state,a.dispatch),u=Object(n.useState)(),l=Object(d.a)(u,2),s=l[0],o=l[1],p=Object(n.useState)(),f=Object(d.a)(p,2),v=f[0],h=f[1],E=Object(n.useState)(void 0),g=Object(d.a)(E,2),O=g[0],j=g[1];Object(n.useEffect)((function(){null!==y.currentUser()&&void 0!==y.currentUser()&&c({type:"LOG_IN"}),t(!1)}),[]);var w=function(){var e=Object(m.a)(i.a.mark((function e(a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(!0),a.preventDefault(),e.prev=2,e.next=5,y.login(s,v,!0);case 5:c({type:"LOG_IN"}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),"invalid_grant: Email not confirmed"==e.t0.message?j("Email not confirmed"):"invalid_grant: No user found with that email, or password invalid."==e.t0.message?j("No user found with that email, or password invalid"):j("Error occured, please try again later");case 11:t(!1);case 12:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("form",{onSubmit:function(e){w(e)},method:"post"},r.a.createElement("label",{htmlFor:"email"},"Email:"),r.a.createElement("input",{type:"email",name:"email",id:"email",onChange:function(e){o(e.target.value),j(void 0)},required:"required"}),r.a.createElement("label",{htmlFor:"password"},"Password:"),r.a.createElement("input",{type:"password",name:"password",id:"password",onChange:function(e){h(e.target.value),j(void 0)},required:"required"}),void 0!==O&&r.a.createElement("p",null,O),r.a.createElement("button",{type:"submit"},"Login"))}),"wait");var q=function(){var e=Object(n.useContext)(b),t=e.state;return e.dispatch,r.a.createElement(l.a,null,r.a.createElement(s.d,null,r.a.createElement(s.b,{exact:!0,path:"/",component:S}),r.a.createElement(s.b,{path:"/signup",component:I},t.loggedIn&&r.a.createElement(s.a,{to:"/"})),r.a.createElement(s.b,{path:"/login",component:k},t.loggedIn&&r.a.createElement(s.a,{to:"/"}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(h,null,r.a.createElement(q,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},54:function(e,t,a){e.exports=a(105)},59:function(e,t,a){},60:function(e,t,a){},81:function(e,t){},83:function(e,t){}},[[54,1,2]]]);
//# sourceMappingURL=main.00847d3e.chunk.js.map